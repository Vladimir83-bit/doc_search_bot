from aiogram import F, types
from aiogram.filters import Command
from bot.core.loader import dp
from bot.utils.logger import logger

@dp.message(Command("help_group"))
@dp.message(F.text == "‚ÑπÔ∏è –ü–æ–º–æ—â—å –¥–ª—è –≥—Ä—É–ø–ø")
async def group_help(message: types.Message):
    """–ü–æ–º–æ—â—å –ø–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é –±–æ—Ç–∞ –≤ –≥—Ä—É–ø–ø–∞—Ö"""
    help_text = (
        "ü§ñ **–ë–æ—Ç –¥–ª—è –ø–æ–∏—Å–∫–∞ –≤ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ö - –ü–æ–º–æ—â—å –¥–ª—è –≥—Ä—É–ø–ø**\n\n"
        "**–î–æ—Å—Ç—É–ø–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã –≤ –≥—Ä—É–ø–ø–∞—Ö:**\n"
        "/help_group - —ç—Ç–∞ —Å–ø—Ä–∞–≤–∫–∞\n"
        "/search_group [–∑–∞–ø—Ä–æ—Å] - –ø–æ–∏—Å–∫ –≤ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ö\n"
        "/list_group - —Å–ø–∏—Å–æ–∫ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤\n\n"
        "**–ö–∞–∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å:**\n"
        "1. –î–æ–±–∞–≤—å—Ç–µ –±–æ—Ç–∞ –≤ –≥—Ä—É–ø–ø—É\n"
        "2. –î–∞–π—Ç–µ –ø—Ä–∞–≤–∞ –Ω–∞ —á—Ç–µ–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏–π\n"
        "3. –ó–∞–≥—Ä—É–∂–∞–π—Ç–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã –≤ –≥—Ä—É–ø–ø—É\n"
        "4. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∫–æ–º–∞–Ω–¥—ã –¥–ª—è –ø–æ–∏—Å–∫–∞\n\n"
        "üí° –ë–æ—Ç –±—É–¥–µ—Ç –∏—Å–∫–∞—Ç—å —Ç–æ–ª—å–∫–æ –≤ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ö, –∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã—Ö –≤ —ç—Ç—É –≥—Ä—É–ø–ø—É!"
    )
    await message.answer(help_text)

@dp.message(Command("search_group"))
async def search_in_group(message: types.Message):
    """–ü–æ–∏—Å–∫ –≤ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ö –≥—Ä—É–ø–ø—ã"""
    try:
        # –ò–∑–≤–ª–µ–∫–∞–µ–º –∑–∞–ø—Ä–æ—Å –∏–∑ –∫–æ–º–∞–Ω–¥—ã
        query = message.text.replace('/search_group', '').strip()
        
        if not query:
            await message.answer("‚ùå –£–∫–∞–∂–∏—Ç–µ –ø–æ–∏—Å–∫–æ–≤—ã–π –∑–∞–ø—Ä–æ—Å: `/search_group –≤–∞—à –∑–∞–ø—Ä–æ—Å`")
            return
        
        # –ó–¥–µ—Å—å –±—É–¥–µ—Ç –ª–æ–≥–∏–∫–∞ –ø–æ–∏—Å–∫–∞ –ø–æ –¥–æ–∫—É–º–µ–Ω—Ç–∞–º –≥—Ä—É–ø–ø—ã
        await message.answer(f"üîç –ü–æ–∏—Å–∫ –≤ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ö –≥—Ä—É–ø–ø—ã –ø–æ –∑–∞–ø—Ä–æ—Å—É: '{query}'\n\n–§—É–Ω–∫—Ü–∏—è –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ...")
        
    except Exception as e:
        logger.error(f"Group search error: {e}")
        await message.answer("‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–∏—Å–∫–µ –≤ –≥—Ä—É–ø–ø–µ")

@dp.message(Command("list_group"))
async def list_group_documents(message: types.Message):
    """–°–ø–∏—Å–æ–∫ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ –≥—Ä—É–ø–ø—ã"""
    try:
        # –ó–¥–µ—Å—å –±—É–¥–µ—Ç –ª–æ–≥–∏–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ –≥—Ä—É–ø–ø—ã
        await message.answer("üìÇ –°–ø–∏—Å–æ–∫ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ –≥—Ä—É–ø–ø—ã:\n\n–§—É–Ω–∫—Ü–∏—è –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ...")
        
    except Exception as e:
        logger.error(f"Group list error: {e}")
        await message.answer("‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ —Å–ø–∏—Å–∫–∞ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ –≥—Ä—É–ø–ø—ã")

# –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –Ω–æ–≤—ã—Ö —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ –≥—Ä—É–ø–ø—ã
@dp.message(F.new_chat_members)
async def new_chat_members(message: types.Message):
    """–ü—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ –Ω–æ–≤—ã—Ö —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤"""
    for user in message.new_chat_members:
        if user.id == (await message.bot.get_me()).id:
            # –ë–æ—Ç–∞ –¥–æ–±–∞–≤–∏–ª–∏ –≤ –≥—Ä—É–ø–ø—É
            welcome_text = (
                "ü§ñ –°–ø–∞—Å–∏–±–æ –∑–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –≤ –≥—Ä—É–ø–ø—É!\n\n"
                "–Ø - –±–æ—Ç –¥–ª—è –ø–æ–∏—Å–∫–∞ –≤ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ö. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ /help_group –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –∫–æ–º–∞–Ω–¥.\n\n"
                "üí° **–ß—Ç–æ–±—ã —è —Ä–∞–±–æ—Ç–∞–ª –ø—Ä–∞–≤–∏–ª—å–Ω–æ, –¥–∞–π—Ç–µ –º–Ω–µ –ø—Ä–∞–≤–∞:**\n"
                "‚Ä¢ –ß—Ç–µ–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏–π\n"
                "‚Ä¢ –î–æ—Å—Ç—É–ø –∫ –¥–æ–∫—É–º–µ–Ω—Ç–∞–º\n"
                "‚Ä¢ –û—Ç–ø—Ä–∞–≤–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏–π"
            )
            await message.answer(welcome_text)